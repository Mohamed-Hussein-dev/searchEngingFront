<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>Drug Search</title>
   <style>
      :root {
         --primary: #1a73e8;
         --bg: #ffffff;
         --text: #202124;
         --border: #dfe1e5;
         --secondary-text: #5f6368;
         --radius: 8px;
      }

      * {
         box-sizing: border-box;
         margin: 0;
         padding: 0;
      }

      body {
         font-family: 'Segoe UI', system-ui, sans-serif;
         background: var(--bg);
         color: var(--text);
         min-height: 100vh;
      }

      .container {
         max-width: 1400px;
         margin: 0 auto;
         padding: 20px;
      }

      .logo {
         text-align: center;
         margin: 40px 0;
         font-size: 2.5rem;
         color: var(--primary);
      }

      .search-box {
         margin-bottom: 30px;
         max-width: 800px;
         margin: 0 auto;
      }

      .search-form {
         display: flex;
         gap: 10px;
         border: 1px solid var(--border);
         border-radius: var(--radius);
         padding: 12px;
         box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
         align-items: center;
      }

      input {
         flex: 1;
         border: none;
         outline: none;
         font-size: 16px;
         padding: 8px;
      }

      .divider {
         width: 1px;
         background: var(--border);
         height: 40px;
         margin: 0 10px;
      }

      button {
         background: var(--primary);
         color: white;
         border: none;
         padding: 12px 24px;
         border-radius: var(--radius);
         cursor: pointer;
         transition: background 0.2s;
      }

      button:hover {
         background: #1557b0;
      }

      .search-notes {
         color: var(--secondary-text);
         font-size: 0.9rem;
         margin-top: 1rem;
         padding: 15px;
         background: #f8f9fa;
         border-radius: var(--radius);
         line-height: 1.5;
      }

      #results {
         display: grid;
         grid-template-columns: repeat(5, 1fr);
         gap: 20px;
         padding: 20px 0;
      }

      .result-item {
         border: 1px solid var(--border);
         border-radius: var(--radius);
         padding: 15px;
         transition: transform 0.2s;
         background: var(--bg);
      }

      .result-image {
         width: 100%;
         height: 180px;
         object-fit: cover;
         border-radius: 4px;
         margin-bottom: 12px;
      }

      .result-title {
         font-size: 1rem;
         color: var(--primary);
         margin-bottom: 8px;
      }

      .result-details div {
         font-size: 0.85rem;
         color: var(--secondary-text);
         margin: 6px 0;
      }

      .loading {
         text-align: center;
         padding: 20px;
         font-size: 1.1rem;
         color: var(--secondary-text);
      }

      .no-results {
         text-align: center;
         padding: 40px 0;
         grid-column: 1 / -1;
         color: var(--secondary-text);
      }

      @media (max-width: 1200px) {
         #results {
            grid-template-columns: repeat(4, 1fr);
         }
      }

      @media (max-width: 992px) {
         #results {
            grid-template-columns: repeat(3, 1fr);
         }
      }

      @media (max-width: 768px) {
         #results {
            grid-template-columns: repeat(2, 1fr);
         }
      }

      @media (max-width: 480px) {
         #results {
            grid-template-columns: 1fr;
         }

         .logo {
            font-size: 2rem;
         }
      }
   </style>
</head>

<body>
   <div class="container">
      <div class="logo">Drug Search</div>

      <div class="search-box">
         <form class="search-form" onsubmit="search(); return false;">
            <input type="text" id="name" placeholder="Search medications..." autofocus>
            <div class="divider"></div>
            <input type="number" id="tolerance" placeholder="Tolerance" min="1" max="10">
            <button type="submit">Search</button>
         </form>
         <div class="search-notes">
            <strong>Search Tips:</strong>
            <ul>
               <li>Enter at least 3 characters of the drug name</li>
               <li>Tolerance = number of allowed typos (default: 10)</li>
               <li>Not finding your drug? Try increasing the tolerance value</li>
               <li>Database contains 10,000 entries - some medications might be missing</li>
            </ul>
         </div>
      </div>

      <div id="results"></div>
   </div>

   <script>
      const resultsDiv = document.getElementById('results');
      const fallbackImage = "https://dummyimage.com/240x180/cccccc/000000&text=No+Image";

      // Populate initial demo results
      function showResults(data) {
         resultsDiv.innerHTML = data.map(item => `
                <div class="result-item">
                    <img class="result-image" 
                        src="${item.imageURL || fallbackImage}" 
                        alt="${item.englishName}">
                    <div class="result-title">${item.englishName}</div>
                    <div class="result-details">
                        <div>ðŸ’° ${item.price} EGP</div>
                        <div>ðŸ§ª ${item.activeIngredient}</div>
                        <div>ðŸ“Š ${item.barCode}</div>
                    </div>
                </div>
            `).join('');
      }

      // Main search function
      async function search() {
         const name = document.getElementById('name').value.trim();
         let tolerance = document.getElementById('tolerance').value.trim();

         try {
            // Show loading state
            resultsDiv.innerHTML = '<div class="loading">Searching medications...</div>';

            // Validate input
            if (!name) throw new Error('Please enter a drug name');
            if (name.length < 3) throw new Error('Minimum 3 characters required');

            // Calculate tolerance if empty
            if (!tolerance) tolerance = 10;

            // API call
            const response = await fetch(
               `https://search-engine-api.runasp.net/api/SearchEngine/search?name=${encodeURIComponent(name)}&tolerance=${tolerance}`
            );

            if (!response.ok) throw new Error(`Error: ${response.status}`);
            const data = await response.json();

            // Handle results
            if (!data.length) {
               resultsDiv.innerHTML = `
                        <div class="no-results">
                            No results found for "${name}"
                            <div style="margin-top:10px;font-size:0.9em">
                                Try increasing tolerance value
                            </div>
                        </div>`;
               return;
            }

            showResults(data);

         } catch (error) {
            resultsDiv.innerHTML = `
                    <div class="no-results">
                        ${error.message}
                        <div style="margin-top:10px;font-size:0.9em">
                            Please try again
                        </div>
                    </div>`;
         }
      }

      // Debounced search input
      let timeout;
      document.getElementById('name').addEventListener('input', (e) => {
         clearTimeout(timeout);
         timeout = setTimeout(() => {
            if (e.target.value.trim().length >= 3) search();
         }, 300);
      });


   </script>
</body>

</html>
